(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b5d5b"],{"1b1e":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page-container"},[a("div",{staticClass:"toolbar"},[a("el-form",{attrs:{inline:!0,model:e.filters}},[a("el-form-item",[a("el-input",{attrs:{clearable:"",placeholder:"用户名"},model:{value:e.filters.username,callback:function(t){e.$set(e.filters,"username",t)},expression:"filters.username"}})],1),a("el-form-item",[a("el-input",{attrs:{clearable:"",placeholder:"昵称"},model:{value:e.filters.nickname,callback:function(t){e.$set(e.filters,"nickname",t)},expression:"filters.nickname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.list}},[e._v(" 查询 ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v(" 新增 ")])],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.results,"highlight-current-row":"",stripe:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{attrs:{title:"用户信息",column:4,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"用户名"}},[e._v(e._s(t.row.userName))]),a("el-descriptions-item",{attrs:{label:"角色"}},e._l(t.row.roles,(function(t){return a("el-tag",{key:t,staticStyle:{"margin-right":"3px"},attrs:{size:"mini"}},[e._v(" "+e._s(t)+" ")])})),1),a("el-descriptions-item",{attrs:{label:"状态"}},[e._v(e._s(0===t.row.status?"正常":"禁用"))]),a("el-descriptions-item",{attrs:{label:"注册时间"}},[e._v(e._s(e._f("formatDate")(t.row.createTime)))]),a("el-descriptions-item",{attrs:{label:"跟帖数量"}},[e._v(e._s(t.row.commentCount))]),a("el-descriptions-item",{attrs:{label:"粉丝数量"}},[e._v(e._s(t.row.fansCount))]),a("el-descriptions-item",{attrs:{label:"关注数量"}},[e._v(e._s(t.row.followCount))]),a("el-descriptions-item",{attrs:{label:"帖子数量"}},[e._v(e._s(t.row.topicCount))]),a("el-descriptions-item",{attrs:{label:"描述"}},[e._v(e._s(t.row.description))])],1)]}}])}),a("el-table-column",{attrs:{prop:"id",label:"编号",width:"100"}}),a("el-table-column",{attrs:{prop:"avatar",label:"头像",width:"80"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("avatar",{attrs:{user:e.row}})]}}])}),a("el-table-column",{attrs:{prop:"userName",label:"用户名",width:"120"}}),a("el-table-column",{attrs:{prop:"nickname",label:"昵称"}}),a("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),a("el-table-column",{attrs:{prop:"score",label:"积分",width:"120"}}),a("el-table-column",{attrs:{prop:"forbidden",label:"是否禁言",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.forbidden?a("span",{staticClass:"tag is-warning"},[-1===t.row.forbiddenEndTime?[e._v("永久禁言")]:[e._v("禁言至："+e._s(e._f("formatDate")(t.row.forbiddenEndTime)))]],2):a("span",{staticClass:"tag is-success"},[e._v("正常")])]}}])}),a("el-table-column",{attrs:{prop:"createTime",label:"注册时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("formatDate")(t.row.createTime))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-dropdown",{attrs:{size:"mini",trigger:"hover",placement:"bottom"},on:{command:e.handleCommand}},[a("el-button",{attrs:{type:"primary"}},[e._v(" 操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:{cmd:"edit",row:t.row}}},[e._v(" 编辑 ")]),t.row.forbidden?a("el-dropdown-item",{attrs:{command:{cmd:"removeForbidden",row:t.row}}},[e._v(" 取消禁言 ")]):a("el-dropdown-item",{attrs:{command:{cmd:"forbidden",row:t.row}}},[e._v(" 禁言 ")]),a("el-dropdown-item",{attrs:{command:{cmd:"scoreLog",row:t.row}}},[e._v(" 积分记录 ")])],1)],1)]}}])})],1),a("div",{staticClass:"pagebar"},[a("el-pagination",{attrs:{"page-sizes":[20,50,100,300],"current-page":e.page.page,"page-size":e.page.limit,total:e.page.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.handlePageChange,"size-change":e.handleLimitChange}})],1),a("el-dialog",{attrs:{visible:e.addFormVisible,"close-on-click-modal":!1,title:"新增"},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1),a("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[a("el-input",{model:{value:e.addForm.nickname,callback:function(t){e.$set(e.addForm,"nickname",t)},expression:"addForm.nickname"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{model:{value:e.addForm.email,callback:function(t){e.$set(e.addForm,"email",t)},expression:"addForm.email"}})],1),a("el-form-item",{attrs:{label:"角色",prop:"roles"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"用户角色"},model:{value:e.addForm.roles,callback:function(t){e.$set(e.addForm,"roles",t)},expression:"addForm.roles"}},e._l(e.roles,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"不填写默认密码123456"},model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v(" 取消 ")]),a("el-button",{attrs:{loading:e.addLoading,type:"primary"},nativeOn:{click:function(t){return e.addSubmit.apply(null,arguments)}}},[e._v(" 提交 ")])],1)],1),a("el-dialog",{attrs:{visible:e.editFormVisible,"close-on-click-modal":!1,title:"编辑"},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editFormRules,"label-width":"80px"}},[a("el-input",{attrs:{type:"hidden"},model:{value:e.editForm.id,callback:function(t){e.$set(e.editForm,"id",t)},expression:"editForm.id"}}),a("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[a("el-input",{model:{value:e.editForm.userName,callback:function(t){e.$set(e.editForm,"userName",t)},expression:"editForm.userName"}})],1),a("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[a("el-input",{model:{value:e.editForm.nickname,callback:function(t){e.$set(e.editForm,"nickname",t)},expression:"editForm.nickname"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{model:{value:e.editForm.email,callback:function(t){e.$set(e.editForm,"email",t)},expression:"editForm.email"}})],1),a("el-form-item",{attrs:{label:"角色",prop:"roles"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"用户角色"},model:{value:e.editForm.roles,callback:function(t){e.$set(e.editForm,"roles",t)},expression:"editForm.roles"}},e._l(e.roles,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"不填写表示不更改密码"},model:{value:e.editForm.password,callback:function(t){e.$set(e.editForm,"password",t)},expression:"editForm.password"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.editForm.status,callback:function(t){e.$set(e.editForm,"status",t)},expression:"editForm.status"}},[a("el-option",{key:0,attrs:{value:0,label:"正常"}}),a("el-option",{key:1,attrs:{value:1,label:"禁用"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v(" 取消 ")]),a("el-button",{attrs:{loading:e.editLoading,type:"primary"},nativeOn:{click:function(t){return e.editSubmit.apply(null,arguments)}}},[e._v(" 提交 ")])],1)],1),a("el-dialog",{attrs:{visible:e.forbiddenFormVisible,"close-on-click-modal":!1,title:"禁言"},on:{"update:visible":function(t){e.forbiddenFormVisible=t}}},[a("el-form",{ref:"forbiddenForm",attrs:{model:e.forbiddenForm,"label-width":"80px"}},[a("el-input",{attrs:{type:"hidden"},model:{value:e.forbiddenForm.userId,callback:function(t){e.$set(e.forbiddenForm,"userId",t)},expression:"forbiddenForm.userId"}}),a("el-form-item",{attrs:{label:"禁言时间",prop:"reason"}},[a("el-select",{model:{value:e.forbiddenForm.days,callback:function(t){e.$set(e.forbiddenForm,"days",t)},expression:"forbiddenForm.days"}},[a("el-option",{attrs:{label:"3天",value:"3"}}),a("el-option",{attrs:{label:"5天",value:"3"}}),a("el-option",{attrs:{label:"7天",value:"7"}}),a("el-option",{attrs:{label:"15天",value:"15"}}),a("el-option",{attrs:{label:"30天",value:"30"}}),a("el-option",{attrs:{label:"永久",value:"-1"}})],1)],1),a("el-form-item",{attrs:{label:"禁言原因",prop:"reason"}},[a("el-select",{model:{value:e.forbiddenForm.reason,callback:function(t){e.$set(e.forbiddenForm,"reason",t)},expression:"forbiddenForm.reason"}},[a("el-option",{attrs:{value:"广告"}}),a("el-option",{attrs:{value:"灌水"}}),a("el-option",{attrs:{value:"涉黄"}}),a("el-option",{attrs:{value:"涉政"}}),a("el-option",{attrs:{value:"其他"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.forbiddenFormVisible=!1}}},[e._v(" 取消 ")]),a("el-button",{attrs:{loading:e.forbiddenLoading,type:"primary"},nativeOn:{click:function(t){return e.forbidden.apply(null,arguments)}}},[e._v(" 禁言 ")])],1)],1),a("score-log",{ref:"scoreLog"})],1)},r=[],i=a("1da1"),l=a("5530"),s=(a("96cf"),a("d3b7"),a("a15b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isShowLog?a("el-dialog",{attrs:{visible:e.isShowLog,width:"80%",title:"积分记录"},on:{"update:visible":function(t){e.isShowLog=t}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.results,"highlight-current-row":"",border:""}},[a("el-table-column",{attrs:{prop:"id",label:"编号"}}),a("el-table-column",{attrs:{prop:"sourceType",label:"来源类型"}}),a("el-table-column",{attrs:{prop:"sourceId",label:"来源编号"}}),a("el-table-column",{attrs:{prop:"description",label:"描述"}}),a("el-table-column",{attrs:{prop:"type",label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(0===t.row.type?"增加":"减少")+" ")]}}],null,!1,2461144749)}),a("el-table-column",{attrs:{prop:"score",label:"积分"}}),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("formatDate")(t.row.createTime))+" ")]}}],null,!1,3078916098)})],1),a("div",{staticClass:"pagebar"},[a("el-pagination",{attrs:{"page-sizes":[20,50,100,300],"current-page":e.page.page,"page-size":e.page.limit,total:e.page.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.handlePageChange,"size-change":e.handleLimitChange}})],1)],1):e._e()}),n=[],d={data:function(){return{isShowLog:!1,userId:0,results:[],listLoading:!1,page:{},filters:{}}},mounted:function(){},methods:{showLog:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.userId=e,t.isShowLog=!0,a.next=4,t.list();case 4:case"end":return a.stop()}}),a)})))()},list:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,a=Object.assign(e.filters,{skipCount:e.getSkipCount(e.page.page,e.page.limit),maxResultCount:e.page.limit}),a.userId=e.userId,t.prev=3,t.next=6,e.axios.post("/api/app/user-score-log/paged",a);case 6:o=t.sent,e.results=o.items,e.page.total=o.totalCount,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](3),e.$notify.error({title:"错误",message:t.t0.message||t.t0});case 14:return t.prev=14,e.listLoading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[3,11,14,17]])})))()},handlePageChange:function(e){this.page.page=e,this.list()},handleLimitChange:function(e){this.page.limit=e,this.list()}}},c=d,m=a("2877"),u=Object(m["a"])(c,s,n,!1,null,"0c62685c",null),p=u.exports,b=a("df3a"),f={components:{ScoreLog:p,Avatar:b["a"]},data:function(){return{results:[],listLoading:!1,page:{},filters:{id:""},selectedRows:[],roles:["owner","admin","user"],addForm:{username:"",nickname:"",avatar:"",email:"",roles:[],password:"",status:""},addFormVisible:!1,addFormRules:{},addLoading:!1,editForm:{id:"",username:"",nickname:"",avatar:"",email:"",roles:[],password:"",status:""},editFormVisible:!1,editFormRules:{},editLoading:!1,forbiddenForm:{userId:"",days:0,reason:""},forbiddenFormVisible:!1,forbiddenLoading:!1}},mounted:function(){this.list()},methods:{list:function(){var e=this;e.listLoading=!0;var t=Object.assign(e.filters,{skipCount:this.getSkipCount(e.page.page,e.page.limit),maxResultCount:e.page.limit});this.axios.post("/api/app/user/paged",t).then((function(t){e.results=t.items,e.page.total=t.totalCount})).finally((function(){e.listLoading=!1}))},handlePageChange:function(e){this.page.page=e,this.list()},handleLimitChange:function(e){this.page.limit=e,this.list()},handleAdd:function(){this.addForm={name:"",description:""},this.addFormVisible=!0},addSubmit:function(){var e=this,t=Object(l["a"])({},this.addForm);t.roles&&t.roles.length?t.roles=t.roles.join(","):t.roles="",this.axios.post("/api/app/user",t).then((function(t){e.$message({message:"提交成功",type:"success"}),e.addFormVisible=!1,e.list()})).catch((function(t){e.$notify.error({title:"错误",message:t.message})}))},handleEdit:function(e){var t=this,a=this;this.axios.get("/api/app/user/".concat(e.id)).then((function(e){a.editForm=Object.assign({},e),t.$set(a.editForm,"password",""),a.editForm.password="",a.editFormVisible=!0})).catch((function(e){a.$notify.error({title:"错误",message:e.message})}))},editSubmit:function(){var e=Object(l["a"])({},this.editForm);e.roles&&e.roles.length?e.roles=e.roles.join(","):e.roles="";var t=this;this.axios.put("/api/app/user/"+e.id,e).then((function(e){t.list(),t.editFormVisible=!1})).catch((function(e){t.$notify.error({title:"错误",message:e.message})}))},handleSelectionChange:function(e){this.selectedRows=e},showForbiddenDialog:function(e){this.forbiddenForm={userId:e.id,days:7,reason:"广告"},this.forbiddenFormVisible=!0},forbidden:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.forbiddenLoading=!0,t.prev=1,t.next=4,e.axios.form("/api/admin/user/forbidden",e.forbiddenForm);case 4:e.forbiddenForm={},e.forbiddenFormVisible=!1,e.$message.success("禁言成功"),e.list(),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](1),e.$message.success("禁言失败 "+(t.t0.message||t.t0));case 13:return t.prev=13,e.forbiddenLoading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])})))()},removeForbidden:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.axios.form("/api/admin/user/forbidden",{userId:e.id,days:0});case 3:t.$message.success("取消禁言成功"),t.list(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$message.success("取消禁言失败 "+(a.t0.message||a.t0));case 10:case"end":return a.stop()}}),a,null,[[0,7]])})))()},showScoreLog:function(e){this.$refs.scoreLog.showLog(e.id)},handleCommand:function(e){"edit"===e.cmd?this.handleEdit(e.row):"removeForbidden"===e.cmd?this.removeForbidden(e.row):"forbidden"===e.cmd?this.showForbiddenDialog(e.row):"scoreLog"===e.cmd&&this.showScoreLog(e.row)}}},g=f,h=Object(m["a"])(g,o,r,!1,null,"505ee283",null);t["default"]=h.exports}}]);
//# sourceMappingURL=chunk-2d0b5d5b.8a6eabc8.js.map